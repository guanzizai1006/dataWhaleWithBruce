# MySQL的第三课

> 项目三：超过5名学生的课（难度：简单）
> 创建如下所示的courses 表 ，有: student (学生) 和 class (课程)。

> 例如,表:


+---------+------------+
| student | class      |
+---------+------------+
| A       | Math       |
| B       | English    |
| C       | Math       |
| D       | Biology    |
| E       | Math       |
| F       | Computer   |
| G       | Math       |
| H       | Math       |
| I       | Math       |
| A       | Math       |
+---------+------------+

编写一个 SQL 查询，列出所有超过或等于5名学生的课。
应该输出:
+---------+
| class   |
+---------+
| Math    |
+---------+

> Note:
> 学生在每个课中不应被重复计算。


## 1. 创建数据库和表

## 2. 插入数据

## 3. 查询（需要注意附加条件：学生在每个课中，不应该被重复计算。比如说，A选了英语，A选了英语，这就重复咯）

> 全部操作如下所示：

(py36_pytorch) bruce@zhengdz-PowerEdge-T310:~/Downloads/git/dataWhaleWithBruce/mysql/Task2$ mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 24
Server version: 5.7.27-0ubuntu0.16.04.1 (Ubuntu)

Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.


### 显示所有的数据库
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| TASK1              |
| mysql              |
| performance_schema |
| sys                |
| world_demo         |
+--------------------+
6 rows in set (0.12 sec)


### 选定名为 TASK1 的数据库
mysql> use TASK1
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

### 显示所有的表
mysql> show tables;
+-----------------+
| Tables_in_TASK1 |
+-----------------+
| Person          |
+-----------------+
1 row in set (0.00 sec)

### 创建名为 courses 的表
mysql> create table courses(
    -> student varchar(100) not null,
	    -> class   varchar(100) not null);
		Query OK, 0 rows affected (0.52 sec)

### 往 world 表中添加数据
mysql> insert into world values('A', 'Math'),('B', 'English'),('C', 'Math'),('D','Biology'),('E','Math'),('F','Computer'),('G','Math'),('H','Math'),('I','Math'),('A','Math');
		ERROR 1146 (42S02): Table 'TASK1.world' doesn't exist
### 往 courses 表中添加数据
mysql> insert into courses values('A', 'Math'),('B', 'English'),('C', 'Math'),('D','Biology'),('E','Math'),('F','Computer'),('G','Math'),('H','Math'),('I','Math'),('A','Math');
		Query OK, 10 rows affected (0.13 sec)
		Records: 10  Duplicates: 0  Warnings: 0

### 显示 courses表中的数据
mysql> select * from courses;
		+---------+----------+
		| student | class    |
		+---------+----------+
		| A       | Math     |
		| B       | English  |
		| C       | Math     |
		| D       | Biology  |
		| E       | Math     |
		| F       | Computer |
		| G       | Math     |
		| H       | Math     |
		| I       | Math     |
		| A       | Math     |
		+---------+----------+
		10 rows in set (0.00 sec)


### 选出表名为courses的列为group的非重复的student的class的个数大于5的class
mysql> select class from courses group by class having count(distinct student) >= 5
		    -> ;
			+-------+
			| class |
			+-------+
			| Math  |
			+-------+
			1 row in set (0.02 sec)

> 当然，还有别的写法

#共三种写法
#最朴实的写法，共三层查询，先利用 DISTINCT 去掉重复记录得到表 A，再利用 GROUP BY 为 CLASS 分组，然
#后用 COUNT() 统计每组个数得到表 B，最后在最外层限定数量 >=5 查到结果
SELECT B.CLASS								#最外层
	FROM (SELECT A.CLASS,COUNT(A.CLASS) C          #第二层查询，得到具有 CLASS、COUNT(CLASS) 的表 B
			FROM (SELECT DISTINCT *				#第三层查询，去重得到表 A
						FROM COURSES) A
							GROUP BY A.CLASS) B						#分组
								WHERE B.C >= 5;							#条件

								#稍微优化，两层查询，主要是因为用了 HAVING 省了一层查询
								SELECT A.CLASS					#最外层
									FROM (SELECT DISTINCT *		#第二层查询，去重得到表 a
											FROM COURSES) A
												GROUP BY A.CLASS			        #分组
													HAVING COUNT(A.CLASS) >= 5;	#利用 COUNT() 计算每组个数并筛选

													#极致优化，一层查询，利用 GROUP BY 为 CLASS 分组后，直接用 COUNT() 统计每组学生个数，在统计前先用
													#DISTINCT 去掉重复学生
													SELECT CLASS
														FROM COURSES
															GROUP BY CLASS							#分组
																HAVING COUNT(DISTINCT STUDENT) >= 5;          #利用 COUNT() 统计每门课 STUDENT 的个数，同时利
																                                       

																									   --------------------- 

																									   版权声明：本文为CSDN博主「submarineas」的原创文章，遵循CC 4.0 by-sa版权协议，转载请附上原文出处链接及本声明。

																									   原文链接：https://blog.csdn.net/submarineas/article/details/98487338


